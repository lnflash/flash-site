<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/treasure-hunt-for-real-this-time-2140/">
    <meta name="description"
        content="Keys of the Caribbean - A $5,000+ Bitcoin treasure hunt across Jamaica combining cryptography, culture, and physical adventure.">
    <title>Keys of the Caribbean | Bitcoin Treasure Hunt</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;700;800&family=Inter:wght@400;500;600&family=Rye&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="css/hunt.css">

    <!-- Lightning Messageboard -->
    <script type="module" src="https://esm.sh/@getalby/lightning-messageboard@latest"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="256x256" href="assets/img/kotc_icon_primary_256.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/kotc_icon_primary_512.png">
    <link rel="apple-touch-icon" sizes="1024x1024" href="assets/img/kotc_icon_primary_1024.png">
</head>

<body class="hunt-page">
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Coming Soon Overlay -->
    <!-- <div class="coming-soon-overlay" style="display: none;" id="comingSoonOverlay">
        <div class="coming-soon-content">
            <div class="coming-soon-icon">üè¥‚Äç‚ò†Ô∏è</div>
            <h2 class="coming-soon-title">The Hunt Begins Soon</h2>
            <p class="coming-soon-subtitle">
                When the moon reaches its final phase this year, the ancient vaults will activate.
                Seven messages and seven private keys await those bold enough to embark upon the adventure of a
                lifetime.
            </p>
            <p class="coming-soon-note">
                The grand prize lies hidden where digital meets dusk. Only the worthy shall find what was lost.
            </p>
            <div
                style="margin: 2rem 0; padding: 1.5rem; background: rgba(65, 173, 73, 0.1); border: 1px solid var(--flash-green); border-radius: 12px;">
                <div style="font-size: 1.1rem; color: var(--flash-yellow); margin-bottom: 0.5rem;">‚ö° Early Registration
                    Opening Soon</div>
                <div style="font-size: 0.95rem; color: var(--sea-gray);">Follow us for updates and be the first to know
                    when registration opens.</div>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="https://twitter.com/LNFlash" target="_blank" class="btn btn-secondary"
                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#1DA1F2">
                        <path
                            d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z" />
                    </svg>
                    Follow on Twitter
                </a>
                <a href="https://www.instagram.com/getflash.io/#" target="_blank" class="btn btn-secondary"
                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="url(#instagram-gradient)">
                        <defs>
                            <linearGradient id="instagram-gradient" x1="0%" y1="100%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#FD5949;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#D6249F;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#285AEB;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5" />
                        <path fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
                        <line fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" x1="17.5" y1="6.5"
                            x2="17.51" y2="6.5" />
                    </svg>
                    Follow on Instagram
                </a>
                <a href="https://discord.gg/8jCg8eCRhF" target="_blank" class="btn btn-secondary"
                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#5865F2">
                        <path
                            d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z" />
                    </svg>
                    Join Discord
                </a>
            </div>
            <a href="../index.html" class="back-button" style="margin-top: 2rem; display: inline-block;">
                <span>‚Üê</span>
                Back to Flash
            </a>
        </div>
    </div> -->

    <!-- Coming Soon Logic -->
    <script>
        (function () {
            const launchDate = new Date('2025-12-01T00:00:00');
            const now = new Date();
            const overlay = document.getElementById('comingSoonOverlay');

            if (now < launchDate) {
                // Before launch date - show overlay
                overlay.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Prevent scrolling
            } else {
                // After launch date - hide overlay
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        })();
    </script>

    <!-- Hero Section -->
    <section class="hero-hunt">
        <canvas id="lightning-bg"></canvas>
        <div class="container">
            <div class="hero-content">

                <!-- Video Teaser -->
                <div class="hunt-video-container">
                    <div class="video-placeholder">
                        <div class="play-button">‚ñ∂</div>
                        <div class="video-overlay">
                            <h3>Watch the Teaser</h3>
                            <p>Coming Soon</p>
                        </div>
                    </div>
                </div>
                <h1 class="hero-title">
                    Keys of the <span class="highlight">Caribbean</span>
                </h1>
                <p class="hero-tagline">Solve the code. Walk the island. Claim the sats.</p>

                <!-- Prize Pool Highlight -->
                <div class="prize-pool-highlight">
                    <div class="prize-icon">üèÜ</div>
                    <div class="prize-details">
                        <div class="prize-label">Total Prize Pool</div>
                        <div class="prize-amount-large">
                            <span class="usd-prefix">USD</span> $<span id="btc-prize-usd">...</span>
                        </div>
                        <div class="prize-btc-info"><span id="btc-prize-amount">0.04</span> BTC in Rewards</div>
                    </div>
                </div>

                <div class="hero-stats">
                    <div class="stat">
                        <div class="stat-value">7</div>
                        <div class="stat-label">Epic Stages</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">21</div>
                        <div class="stat-label">Prizes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">13</div>
                        <div class="stat-label">Geocaches</div>
                    </div>
                </div>
                <div class="hero-cta">
                    <a href="register.html" class="btn btn-large btn-primary">Begin Your Journey</a>
                    <a href="#about" class="btn btn-large btn-secondary">Learn More</a>
                </div>
                <div class="hero-scroll">
                    <span>Scroll to explore</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 4V16M10 16L4 10M10 16L16 10" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-hunt">
        <div class="container">
            <div class="section-header">
                <div class="hunt-badge">Season 1 ‚Äî The Vault</div>

                <h2>The Legend Begins</h2>
                <p class="section-subtitle">Before Satoshi disappeared, they left encrypted clues across the
                    Caribbean, a paradise known for its beauty and its people's struggle for freedom. If you choose to
                    embark upon this journey, you will need more than just smarts. You'll need courage, curiosity,
                    friends, and a spirit of adventure.</p>
            </div>
            <div class="about-grid">
                <div class="about-card">
                    <div class="card-icon">üîê</div>
                    <h3>Cryptographic Puzzles</h3>
                    <p>Decode messages, analyze blockchain transactions, and crack ciphers using real Bitcoin history
                        and cryptography.</p>
                </div>
                <div class="about-card">
                    <div class="card-icon">üáØüá≤</div>
                    <h3>Physical Adventure</h3>
                    <p>Discover hidden markers and geocaches, interact with Flash merchants, and prove your
                        knowledge of our culture.</p>
                </div>
                <div class="about-card">
                    <div class="card-icon">‚ö°</div>
                    <h3>Lightning Rewards</h3>
                    <p>Win Bitcoin prizes at every stage via instant LNURL withdrawals. Satoshis flow directly to your
                        wallet.</p>
                </div>
                <div class="about-card">
                    <div class="card-icon">üèÜ</div>
                    <h3>Satoshi's Secret Vault</h3>
                    <p>Find the hidden vault and claim the ultimate prize. But are you worthy of Satoshi's legacy?</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Leaderboard Preview Section -->
    <section id="leaderboard" class="leaderboard-preview">
        <div class="container">
            <div class="section-header">
                <h2>Hall of Heroes</h2>
                <p class="section-subtitle">Track the progress of legendary hunters on their quest to unlock the vault.
                </p>
            </div>
            <div class="leaderboard-container">
                <div class="leaderboard-header">
                    <div>Rank</div>
                    <div>Hunter</div>
                    <div>Stage</div>
                    <div>Total Sats</div>
                    <div>Status</div>
                </div>
                <div id="leaderboard-data" class="leaderboard-body">
                    <!-- Placeholder for now, will be populated via API -->
                    <div class="leaderboard-empty">
                        <div class="empty-icon">üè¥‚Äç‚ò†Ô∏è</div>
                        <p>The hunt has not yet begun...</p>
                        <p class="empty-subtitle">Be among the first to register and claim your place in history.</p>
                    </div>
                </div>
                <a href="leaderboard.html" class="btn btn-secondary">View Full Leaderboard</a>
            </div>
        </div>
    </section>

    <!-- Prizes Section -->
    <section id="prizes" class="prizes-hunt">
        <div class="container">
            <div class="section-header">
                <h2>The Treasure Awaits</h2>
                <p class="section-subtitle">Over $<span id="total-prize-subtitle">5,000</span> in Bitcoin prizes
                    distributed via Lightning Network.</p>
            </div>
            <div class="prizes-grid">
                <div class="prize-card prize-main">
                    <div class="prize-icon">üèÜ</div>
                    <h3>The Vault</h3>
                    <div class="prize-amount" id="vault-prize">$2,500</div>
                    <p>The ultimate prize for those who complete all seven stages.</p>
                </div>
                <div class="prize-card">
                    <div class="prize-icon">‚ö°</div>
                    <h3>Stage Rewards</h3>
                    <div class="prize-amount"><span id="stage-min">$13</span> - <span id="stage-max">$525</span></div>
                    <p>Win Bitcoin at each stage. Every step forward earns you satoshis.</p>
                </div>
                <div class="prize-card">
                    <div class="prize-icon">üåü</div>
                    <h3>Hidden Prizes</h3>
                    <div class="prize-amount">$???</div>
                    <p>Share with the community and earn eternal recognition in the Hall of Heroes.</p>
                </div>
            </div>
            <div class="prizes-cta">
                <a href="register.html" class="btn btn-large btn-primary">Start Your Hunt</a>
            </div>
        </div>
    </section>

    <!-- Donate Section -->
    <section id="donate" class="donate-hunt">
        <div class="container">
            <div class="section-header">
                <h2>Grow the Prize Pool</h2>
                <p class="section-subtitle">Help make this the greatest Bitcoin treasure hunt in the Caribbean. Every
                    satoshi adds to the adventure!</p>
            </div>

            <div class="donate-grid">
                <!-- Lightning Donations -->
                <div class="donate-card">
                    <div class="donate-icon">‚ö°</div>
                    <h3>Lightning Donations</h3>
                    <p>Send sats instantly and leave a message for the hunters!</p>

                    <!-- Lightning Donation Tracker -->
                    <div class="donation-tracker">
                        <div class="tracker-label">Total Lightning Donations Received:</div>
                        <div class="tracker-amount">
                            <span id="lightningBTC">...</span> BTC
                            <span class="tracker-usd">(<span id="lightningUSD">...</span> USD)</span>
                        </div>
                    </div>

                    <div class="lightning-board-container">
                        <lightning-messageboard
                            nwc-url="nostr+walletconnect://ba6aa6d6f6859c8e5a969bf36df6d6702664107995a4fdc4e6cae97f0766f25f?relay=wss://relay.getalby.com/v1&secret=1fc7325f6c10eefb94e9ea197e6c981a45a2097b1a9c202be321727f5f5f5785"></lightning-messageboard>
                    </div>
                </div>

                <!-- On-Chain Donations -->
                <div class="donate-card">
                    <div class="donate-icon">‚Çø</div>
                    <h3>On-Chain Donations</h3>
                    <p>Send Bitcoin directly to the treasure pool</p>

                    <!-- Donation Tracker -->
                    <div class="donation-tracker">
                        <div class="tracker-label">Total On-Chain Donations Received:</div>
                        <div class="tracker-amount">
                            <span id="donationBTC">...</span> BTC
                            <span class="tracker-usd">(<span id="donationUSD">...</span> USD)</span>
                        </div>
                    </div>

                    <div class="bitcoin-address">
                        <div class="address-label">Bitcoin Address:</div>
                        <div class="address-value" id="btcAddress">
                            bc1qdq2cs8r4rpe069c2zvu6rvh8aswyfvz5ezwv0kplutg9h68qwqlssmqer9</div>
                        <button class="copy-btn" onclick="copyAddress()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy Address
                        </button>
                    </div>
                    <div class="donate-note">
                        <strong>Note:</strong> On-chain donations may take longer to confirm but are perfect for larger
                        contributions.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <!-- Component Loader -->
    <script src="components/loader.js"></script>

    <!-- Scripts -->
    <script src="js/hunt.js"></script>

    <!-- Shared Utilities -->
    <script>
        const BASE_PRIZE_BTC = 0.04; // Base prize pool
        const DONATION_ADDRESS = 'bc1qdq2cs8r4rpe069c2zvu6rvh8aswyfvz5ezwv0kplutg9h68qwqlssmqer9';

        // Fetch donations from Bitcoin address
        async function fetchDonationsAmount() {
            try {
                const response = await fetch(`https://blockstream.info/api/address/${DONATION_ADDRESS}`);
                if (!response.ok) throw new Error('Failed to fetch donations');

                const data = await response.json();
                const totalSatoshis = data.chain_stats.funded_txo_sum + data.mempool_stats.funded_txo_sum;
                return totalSatoshis / 100000000; // Convert to BTC
            } catch (error) {
                console.error('Error fetching donations:', error);
                return 0;
            }
        }

        // Get Bitcoin price
        async function getBitcoinPrice() {
            try {
                const response = await fetch('https://api.coindesk.com/v1/bpi/currentprice/BTC.json');
                const data = await response.json();
                return data.bpi.USD.rate_float;
            } catch (error) {
                console.error('Error fetching BTC price:', error);
                return 100000; // Fallback price
            }
        }
    </script>

    <script>
        // Copy Bitcoin Address
        function copyAddress() {
            const address = document.getElementById('btcAddress').textContent;
            navigator.clipboard.writeText(address).then(() => {
                const btn = event.currentTarget;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // Smooth scroll to donate section
        document.querySelectorAll('a[href="#donate"]').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const donateSection = document.getElementById('donate');
                if (donateSection) {
                    donateSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    // Close mobile menu if open
                    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
                    const navLinks = document.getElementById('navLinks');
                    if (mobileMenuToggle && navLinks) {
                        mobileMenuToggle.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                }
            });
        });

        // Track on-chain donations
        async function fetchDonations() {
            const btcElement = document.getElementById('donationBTC');
            const usdElement = document.getElementById('donationUSD');

            try {
                // Fetch donations and Bitcoin price
                const totalReceived = await fetchDonationsAmount();
                const btcPrice = await getBitcoinPrice();

                // Update display
                btcElement.textContent = totalReceived.toFixed(8);
                const usdValue = (totalReceived * btcPrice).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                usdElement.textContent = `$${usdValue}`;

            } catch (error) {
                console.error('Error fetching donations:', error);
                btcElement.textContent = '0.00000000';
                usdElement.textContent = '$0.00';
            }
        }

        // Fetch donations on page load and refresh every 60 seconds
        fetchDonations();
        setInterval(fetchDonations, 60000);

        // Track Lightning donations
        async function fetchLightningDonations() {
            const btcElement = document.getElementById('lightningBTC');
            const usdElement = document.getElementById('lightningUSD');

            try {
                // Fetch Lightning donations from KOTC API
                const response = await fetch('https://kotc.islandbitcoin.com/api/lightning-donations.php');
                const data = await response.json();

                if (data.success) {
                    // Update display
                    btcElement.textContent = data.totalBTC.toFixed(8);
                    const usdValue = data.totalUSD.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                    usdElement.textContent = `$${usdValue}`;
                } else {
                    throw new Error(data.error || 'Failed to fetch Lightning donations');
                }

            } catch (error) {
                console.error('Error fetching Lightning donations:', error);
                btcElement.textContent = '0.00000000';
                usdElement.textContent = '$0.00';
            }
        }

        // Fetch Lightning donations on page load and refresh every 60 seconds
        fetchLightningDonations();
        setInterval(fetchLightningDonations, 60000);
    </script>

    <!-- Welcome Message for Successful Hunters -->
    <script>
        const styles = {
            success: 'background: linear-gradient(90deg, #41AD49, #F5A623); color: #000; font-size: 20px; font-weight: bold; padding: 10px 20px; border-radius: 4px;',
            text: 'color: #41AD49; font-size: 16px; font-weight: bold;',
            normal: 'color: #fff; font-size: 14px;'
        };

        console.clear();
        console.log('%c üéâ CONGRATULATIONS! üéâ ', styles.success);
        console.log('%c\n‚úÖ You solved the puzzle and found the real treasure hunt!', styles.text);
        console.log('%c\nYou\'ve proven you have what it takes:', styles.normal);
        console.log('%c  ‚úì Curiosity to explore', styles.normal);
        console.log('%c  ‚úì Knowledge of Bitcoin fundamentals', styles.normal);
        console.log('%c  ‚úì Persistence to find hidden paths', styles.normal);
        console.log('%c\nWelcome to Keys of the Caribbean.', styles.text);
        console.log('%cYour real adventure begins now... üè¥‚Äç‚ò†Ô∏è‚ö°\n', styles.normal);

        // Countdown Timer
        const launchDate = new Date('2025-12-01T00:00:00').getTime();
        const countdownStyle = {
            timer: 'color: #F6C453; font-size: 18px; font-weight: bold;',
            label: 'color: #41AD49; font-size: 14px;'
        };

        function updateConsoleCountdown() {
            const now = new Date().getTime();
            const distance = launchDate - now;

            if (distance < 0) {
                console.log('%c\nüè¥‚Äç‚ò†Ô∏è THE HUNT IS LIVE! üè¥‚Äç‚ò†Ô∏è', styles.success);
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            console.clear();
            console.log('%c üéâ CONGRATULATIONS! üéâ ', styles.success);
            console.log('%c\n‚úÖ You solved the puzzle and found the real treasure hunt!', styles.text);
            console.log('%c\nYou\'ve proven you have what it takes:', styles.normal);
            console.log('%c  ‚úì Curiosity to explore', styles.normal);
            console.log('%c  ‚úì Knowledge of Bitcoin fundamentals', styles.normal);
            console.log('%c  ‚úì Persistence to find hidden paths', styles.normal);
            console.log('%c\nWelcome to Keys of the Caribbean.', styles.text);
            console.log('%cYour real adventure begins now... üè¥‚Äç‚ò†Ô∏è‚ö°\n', styles.normal);
            console.log('%c‚è≥ LAUNCH COUNTDOWN ‚è≥', countdownStyle.label);
            console.log('%c' + days + ' days ' + String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0'), countdownStyle.timer);
            // console.log('%cDecember 1st, 2025 - The vaults will activate...', countdownStyle.label);
        }

        // Initial display
        updateConsoleCountdown();

        // Update every second
        setInterval(updateConsoleCountdown, 1000);
    </script>

    <!-- Bitcoin Prize Pool Calculator -->
    <script>
        // Update all prize amounts proportionally based on total pool
        function updatePrizeAmounts(totalUSD) {
            // Calculate proportional prizes
            const vaultPrize = totalUSD * 0.50;  // 50% for The Vault
            const stageMin = totalUSD * 0.002;     // 2% for minimum stage reward
            const stageMax = totalUSD * 0.10;     // 10% for maximum stage reward

            // Format values with commas
            const formatUSD = (value) => {
                return Math.round(value).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };

            // Update DOM elements
            const vaultElement = document.getElementById('vault-prize');
            const stageMinElement = document.getElementById('stage-min');
            const stageMaxElement = document.getElementById('stage-max');
            const subtitleElement = document.getElementById('total-prize-subtitle');

            if (vaultElement) vaultElement.textContent = '$' + formatUSD(vaultPrize);
            if (stageMinElement) stageMinElement.textContent = '$' + formatUSD(stageMin);
            if (stageMaxElement) stageMaxElement.textContent = '$' + formatUSD(stageMax);
            if (subtitleElement) subtitleElement.textContent = formatUSD(totalUSD);
        }

        async function fetchPrizePoolValue(count) {
            const prizeUsdElement = document.getElementById("btc-prize-usd");
            const prizeBtcElement = document.getElementById("btc-prize-amount");
            const urls = [
                "https://api.blink.sv/graphql",
                "https://api.api-ninjas.com/v1/bitcoin",
                "https://api.coindesk.com/v1/bpi/currentprice/BTC.json"
            ];
            const keys = ["", "3hidiKMZHXcxRmJ0nwVgqQ==W6IfaDGnbQ7U4gOV", ""];
            let apiCount = count;

            if (prizeUsdElement && prizeBtcElement) {
                const url = urls[apiCount];
                let data = null;
                let response;
                try {
                    if (apiCount < 1) {
                        response = await fetch(url, {
                            method: "POST",
                            headers: {
                                "content-type": "application/json"
                            },
                            body: JSON.stringify({
                                query: `query RealtimePrice($currency: DisplayCurrency) {realtimePrice(currency: $currency) {btcSatPrice {base}}}`,
                                variables: {
                                    currency: "USD"
                                }
                            })
                        });
                    } else {
                        response = await fetch(url, {
                            headers: {
                                "content-type": "application/json",
                                "x-api-key": keys[apiCount],
                            }
                        });
                    }
                    if (!response.ok) {
                        throw new Error(`URL: ${url}, Response status: ${response.status}`);
                    }
                    data = await response.json();

                    if (data !== null) {
                        let price;
                        switch (apiCount) {
                            case 0:
                                price = data.data.realtimePrice.btcSatPrice.base;
                                price = price / 1000000;
                                break;
                            case 1:
                                price = data.price;
                                price = parseFloat(price.split(",").join(""));
                                break;
                            case 2:
                                price = data.bpi.USD.rate;
                                price = parseFloat(price.split(",").join(""));
                                break;
                            default:
                                break;
                        }

                        // Fetch donations and calculate total prize pool
                        const onChainDonations = await fetchDonationsAmount();

                        // Fetch Lightning donations
                        let lightningDonations = 0;
                        try {
                            const lightningResponse = await fetch('https://kotc.islandbitcoin.com/api/lightning-donations.php');
                            const lightningData = await lightningResponse.json();
                            if (lightningData.success) {
                                lightningDonations = lightningData.totalBTC;
                            }
                        } catch (e) {
                            console.log('Lightning donations not yet available');
                        }

                        const totalBTC = BASE_PRIZE_BTC + onChainDonations + lightningDonations;

                        // Calculate total BTC in USD
                        const totalUSD = price * totalBTC;
                        const prizeValue = totalUSD.toFixed(0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                        // Update BTC display (remove trailing zeros)
                        prizeBtcElement.textContent = totalBTC.toFixed(8).replace(/\.?0+$/, '');

                        // Update distributed prize amounts proportionally
                        updatePrizeAmounts(totalUSD);

                        // Animate the USD update
                        prizeUsdElement.classList.remove("animate_in");
                        prizeUsdElement.classList.add("animate_out");
                        setTimeout(() => {
                            prizeUsdElement.classList.remove("animate_out");
                            prizeUsdElement.classList.add("animate_in");
                            prizeUsdElement.innerText = prizeValue;
                        }, 520);

                        // Update again in 10 minutes
                        setTimeout(() => {
                            fetchPrizePoolValue(apiCount);
                        }, 600000);
                    }
                } catch (error) {
                    console.error(error.message);
                    apiCount++;
                    if (apiCount < urls.length) {
                        fetchPrizePoolValue(apiCount);
                    } else {
                        // If all APIs fail, show approximate value (assuming ~$100k BTC price)
                        const fallbackUSD = 120000;
                        prizeUsdElement.innerText = "120,000";
                        prizeBtcElement.textContent = BASE_PRIZE_BTC.toString();
                        updatePrizeAmounts(fallbackUSD);
                    }
                }
            }
        }

        // Start fetching prize pool value
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => fetchPrizePoolValue(0));
        } else {
            fetchPrizePoolValue(0);
        }
    </script>
</body>

</html>