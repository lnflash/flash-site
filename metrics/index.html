<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Flash Growth Metrics" />
    <!-- Add two link elements for favicon -->
    <link rel="shortcut icon" type="image/png" href="../assets/img/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/img/favicon-16x16.png" sizes="16x16" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../css/pages/metrics.css" />
    <script src="../js/core/dark-mode-init.js"></script>
    <title>Flash Growth Metrics</title>
</head>

<body>
    <div id="header-placeholder"></div>

    <main>
        <section class="page dashboard-page">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h1>Flash Growth Metrics</h1>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="users">User Metrics</div>
                    <div class="tab" data-tab="transactions">Transaction Metrics</div>
                    <div class="tab" data-tab="products">Product Metrics</div>
                    <div class="tab" data-tab="market">Market Metrics</div>
                </div>

                <!-- User Metrics Tab -->
                <div id="users" class="tab-content active">
                    <div class="cards-row">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Monthly Active Users (MAU)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="mauChart"></canvas>
                                </div>
                                <div class="growth-indicator">
                                    Growth: <span class="growth-positive">+15.14% MoM</span>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">User Growth Breakdown</h3>
                            </div>
                            <div class="card-body">
                                <div class="metric-grid">
                                    <div class="metric-box">
                                        <div class="metric-label">Total App Downloads</div>
                                        <div class="metric-value">357</div>
                                    </div>
                                    <div class="metric-box">
                                        <div class="metric-label">Onboarded Merchants</div>
                                        <div class="metric-value">19</div>
                                    </div>
                                </div>
                                <div class="metric-grid">
                                    <div class="metric-box">
                                        <div class="metric-label">Daily Website Visitors</div>
                                        <div class="metric-value">500+</div>
                                    </div>
                                    <div class="metric-box">
                                        <div class="metric-label">Resolved Support Tickets</div>
                                        <div class="metric-value">137</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transaction Metrics Tab -->
                <div id="transactions" class="tab-content">
                    <div class="cards-row">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Transaction Volume (SATS)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="volumeChart"></canvas>
                                </div>
                                <div class="growth-indicator">
                                    Average Growth: <span class="growth-positive">+107% MoM</span>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Average Transaction Value (SATS)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="avgValueChart"></canvas>
                                </div>
                                <div class="growth-indicator">
                                    Average Growth: <span class="growth-positive">+176.10% MoM</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cards-row">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Fee Revenue (SATS)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="feeChart"></canvas>
                                </div>
                                <div class="growth-indicator">
                                    Median Growth: <span class="growth-positive">+92.56% MoM</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Metrics Tab -->
                <div id="products" class="tab-content">
                    <div class="cards-row">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">POS Devices Deployed</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="posChart"></canvas>
                                </div>
                                <div class="growth-indicator">
                                    Growth: <span class="growth-positive">+72.0% MoM</span>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Rewards Cards Issued</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="cardsChart"></canvas>
                                </div>
                                <div class="growth-indicator">
                                    Growth: <span class="growth-positive">+47% MoM</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Metrics Tab -->
                <div id="market" class="tab-content">
                    <div class="cards-row">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Market Share in Jamaica</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="marketShareChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Geographic Merchant Expansion</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="geoExpansionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cards-row">
                        <!-- <div class="dashboard-card">
                            <div class="card-header">
                                <h3 class="card-title">Market Penetration by Region (%)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="marketPenetrationChart"></canvas>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <div id="svg-icons-placeholder"></div>

    <!-- Load components BEFORE other scripts -->
    <script src="../js/core/component-loader.js"></script>

    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>

    <!-- GSAP & Plugins CDN -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Set theme class on body
            const theme = localStorage.getItem('theme') || 'light';
            document.body.classList.add(theme);

            // Tab switching functionality
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Add active class to current tab and content
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Common chart configuration
            function getChartOptions(type) {
                const isDark = document.body.classList.contains('dark');
                const textColor = isDark ? '#EEEEEE' : '#333333';
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

                const commonOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: textColor
                            }
                        },
                        tooltip: {
                            backgroundColor: isDark ? '#222' : '#fff',
                            titleColor: textColor,
                            bodyColor: textColor,
                            borderColor: gridColor,
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    }
                };

                if (type === 'horizontalBar') {
                    return {
                        ...commonOptions,
                        indexAxis: 'y'
                    };
                } else if (type === 'pie') {
                    return {
                        ...commonOptions,
                        scales: {} // No scales for pie charts
                    };
                }

                return commonOptions;
            }

            // Sample data
            const mauData = {
                labels: ['Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025'],
                datasets: [{
                    label: 'Monthly Active Users',
                    data: [120, 220, 231, 271, 321, 352],
                    borderColor: '#FFC109',
                    backgroundColor: 'rgba(255, 193, 7, 0.21)',
                    tension: 0.3,
                    fill: true
                }]
            };

            const transactionData = {
                labels: ['Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025'],
                datasets: [{
                    label: 'Volume (Satoshis)',
                    data: [1681636, 738614, 3865093, 11615655, 26219739, 20708873],
                    backgroundColor: 'rgba(255, 193, 7, 0.7)'
                }]
            };

            const avgValueData = {
                labels: ['Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025'],
                datasets: [{
                    label: 'Average Value (Satoshis)',
                    data: [6527, 5240, 45938, 99050, 79222, 75796],
                    borderColor: '#F57C00',
                    backgroundColor: 'rgba(245, 124, 0, 0.21)',
                    tension: 0.3,
                    fill: true
                }]
            };

            const feeData = {
                labels: ['Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025'],
                datasets: [{
                    label: 'Fee Revenue (Satoshis)',
                    data: [-3284, 57972, 109306, -3946],
                    borderColor: '#F57C00',
                    backgroundColor: 'rgba(245, 124, 0, 0.2)',
                    tension: 0.3,
                    fill: true
                }]
            };

            const posData = {
                labels: ['Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025'],
                datasets: [{
                    label: 'POS Devices',
                    data: [1, 2, 2, 5, 7, 12],
                    backgroundColor: 'rgba(255, 193, 7, 0.7)'
                }]
            };

            const cardsData = {
                labels: ['Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025', 'Feb 2025'],
                datasets: [{
                    label: 'Flash Cards',
                    data: [36, 57, 89, 122, 201, 276],
                    borderColor: '#F57C00',
                    backgroundColor: 'rgba(245, 124, 0, 0.2)',
                    tension: 0.3,
                    fill: true
                }]
            };

            const marketShareData = {
                labels: ['Flash', 'Others', 'No Wallet'],
                datasets: [{
                    label: 'Market Share %',
                    data: [1, 4, 95],
                    backgroundColor: [
                        'rgba(0, 193, 7, 0.8)',
                        'rgba(245, 124, 0, 0.8)',
                        'rgba(255, 193, 7, 0.6)',
                        'rgba(245, 124, 0, 0.6)',
                        'rgba(200, 200, 200, 0.8)'
                    ]
                }]
            };

            const geoData = {
                labels: ['Portland', 'St. Ann', 'St. Elizabeth', 'Kingston'],
                datasets: [{
                    label: '# of Merchants',
                    data: [4, 10, 3, 2],
                    backgroundColor: 'rgba(255, 193, 7, 0.7)'
                }]
            };

            const penetrationData = {
                labels: ['Portland', 'St. Ann', 'St. Elizabeth', 'Kingston', 'Other'],
                datasets: [{
                    label: 'Penetration %',
                    data: [14, 11, 9, 4, 0],
                    backgroundColor: 'rgba(245, 124, 0, 0.7)'
                }]
            };

            // Create charts
            const mauChart = new Chart(
                document.getElementById('mauChart'),
                {
                    type: 'line',
                    data: mauData,
                    options: getChartOptions('line')
                }
            );

            const volumeChart = new Chart(
                document.getElementById('volumeChart'),
                {
                    type: 'bar',
                    data: transactionData,
                    options: getChartOptions('bar')
                }
            );

            const avgValueChart = new Chart(
                document.getElementById('avgValueChart'),
                {
                    type: 'line',
                    data: avgValueData,
                    options: getChartOptions('line')
                }
            );

            const feeChart = new Chart(
                document.getElementById('feeChart'),
                {
                    type: 'line',
                    data: feeData,
                    options: getChartOptions('line')
                }
            );

            const posChart = new Chart(
                document.getElementById('posChart'),
                {
                    type: 'bar',
                    data: posData,
                    options: getChartOptions('bar')
                }
            );

            const cardsChart = new Chart(
                document.getElementById('cardsChart'),
                {
                    type: 'line',
                    data: cardsData,
                    options: getChartOptions('line')
                }
            );

            const marketShareChart = new Chart(
                document.getElementById('marketShareChart'),
                {
                    type: 'pie',
                    data: marketShareData,
                    options: getChartOptions('pie')
                }
            );

            const geoExpansionChart = new Chart(
                document.getElementById('geoExpansionChart'),
                {
                    type: 'bar',
                    data: geoData,
                    options: getChartOptions('horizontalBar')
                }
            );

            const marketPenetrationChart = new Chart(
                document.getElementById('marketPenetrationChart'),
                {
                    type: 'bar',
                    data: penetrationData,
                    options: getChartOptions('horizontalBar')
                }
            );

            // Handle dark mode toggle functionality
            const darkmodeSwitch = document.querySelectorAll('.darkmode-switch');
            darkmodeSwitch.forEach(function (el) {
                el.addEventListener('click', function () {
                    document.body.classList.toggle('dark');
                    document.body.classList.toggle('light');

                    const isDark = document.body.classList.contains('dark');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');

                    document.getElementById('darkmode-text').textContent = isDark ? 'On' : 'Off';

                    // Update chart themes
                    const charts = [
                        mauChart, volumeChart, avgValueChart, feeChart,
                        posChart, cardsChart, marketShareChart,
                        geoExpansionChart, marketPenetrationChart
                    ];

                    charts.forEach(chart => {
                        if (chart.config.type === 'pie') {
                            chart.options = getChartOptions('pie');
                        } else if (chart.options.indexAxis === 'y') {
                            chart.options = getChartOptions('horizontalBar');
                        } else if (chart.config.type === 'line') {
                            chart.options = getChartOptions('line');
                        } else {
                            chart.options = getChartOptions('bar');
                        }
                        chart.update();
                    });
                });
            });
        });
    </script>

    <!-- Flash website JavaScript -->
    <script src="../js/core/main.js"></script>
    <script src="../js/modules/btcTracker.js"></script>
</body>

</html>